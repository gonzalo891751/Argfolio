<!DOCTYPE html>
<html lang="es" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invesco QQQ Trust (QQQ) — Argfolio</title>
    
    <!-- Fonts: Brand Book Truth -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Config: Brand Book Truth -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            primary: '#6366f1', // Indigo
                            accent: '#0ea5e9', // Sky
                        },
                        semantic: {
                            up: '#10b981', // Emerald
                            down: '#f43f5e', // Rose
                            warn: '#f59e0b', // Amber
                            info: '#3b82f6', // Blue
                        }
                    },
                    boxShadow: {
                        'glow': '0 0 20px -5px rgba(99, 102, 241, 0.3)',
                        'glow-sm': '0 0 10px -2px rgba(99, 102, 241, 0.2)',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --bg-app: #0B1121;
            --glass-panel: rgba(30, 41, 59, 0.4);
            --border-subtle: rgba(255,255,255,0.08);
        }
        body {
            background-color: var(--bg-app);
            color: #F8FAFC;
        }
        .glass {
            background: var(--glass-panel);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-subtle);
        }
        /* Custom scrollbar for tables */
        .custom-scroll::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.02);
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* Utility for tabular numbers */
        .tabular-nums {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Navbar Fake -->
    <nav class="sticky top-0 z-50 glass border-b border-white/5 px-6 py-4 flex justify-between items-center mb-8">
        <div class="flex items-center gap-3">
            <svg class="w-6 h-6 text-brand-primary" viewBox="0 0 40 40" fill="none">
                <path d="M20 4L4 36H12L20 20L28 36H36L20 4Z" fill="currentColor"/>
                <circle cx="20" cy="14" r="3" class="text-white" fill="currentColor"/>
            </svg>
            <span class="font-display font-bold tracking-wide text-sm text-slate-300">Argfolio / Mis Activos</span>
        </div>
        <div class="flex items-center gap-4">
            <div class="h-8 w-8 rounded-full bg-brand-primary/20 text-brand-primary flex items-center justify-center font-bold text-xs">JM</div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">

        <!-- 01. HEADER & BREADCRUMB -->
        <header class="space-y-6">
            <nav class="flex items-center text-xs text-slate-500 font-mono space-x-2">
                <span class="hover:text-white cursor-pointer transition">Mis Activos</span>
                <span>/</span>
                <span class="hover:text-white cursor-pointer transition">CEDEARs</span>
                <span>/</span>
                <span class="hover:text-white cursor-pointer transition">InvertirOnline</span>
                <span>/</span>
                <span class="text-brand-primary font-bold">QQQ</span>
            </nav>

            <div class="flex flex-col md:flex-row md:items-start justify-between gap-6">
                <div class="flex items-start gap-5">
                    <!-- Asset Icon Placeholder -->
                    <div class="w-16 h-16 rounded-2xl bg-slate-800 border border-white/10 flex items-center justify-center shadow-lg shadow-indigo-500/10 shrink-0">
                        <span class="font-display font-bold text-2xl text-white tracking-tighter">QQQ</span>
                    </div>
                    
                    <div>
                        <h1 class="text-3xl md:text-4xl font-display font-bold text-white tracking-tight">
                            Invesco QQQ Trust
                        </h1>
                        <div class="flex flex-wrap items-center gap-3 mt-2 text-sm text-slate-400">
                            <span class="bg-slate-800/50 border border-white/10 px-2 py-0.5 rounded text-xs font-medium text-slate-300">CEDEAR</span>
                            <span>Ratio 20:1</span>
                            <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                            <span>Nasdaq-100</span>
                        </div>
                    </div>
                </div>

                <!-- Market Data Chips (MEP Context) -->
                <div class="flex flex-col items-end gap-2">
                    <div class="flex gap-2">
                        <div class="px-3 py-1.5 rounded-lg bg-slate-900 border border-white/10 text-xs font-mono text-slate-400 flex items-center gap-2" title="Tipo de Cambio MEP Vendedor (Lo que pagás para comprar USD)">
                            <span>MEP VENTA</span>
                            <span class="text-white font-bold" id="mep-sell-display">...</span>
                        </div>
                        <div class="px-3 py-1.5 rounded-lg bg-slate-900 border border-white/10 text-xs font-mono text-slate-400 flex items-center gap-2" title="Tipo de Cambio MEP Comprador (Lo que recibís al vender USD)">
                            <span>MEP COMPRA</span>
                            <span class="text-white font-bold" id="mep-buy-display">...</span>
                        </div>
                    </div>
                    <span class="text-[10px] text-slate-600 uppercase tracking-wider">Act. 14:30hs · Mercado Abierto</span>
                </div>
            </div>
        </header>

        <!-- 02. HERO CARDS (Stats) -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Card 1: Valuation (USD Focus) -->
            <div class="glass rounded-2xl p-6 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition duration-500">
                    <svg class="w-24 h-24 text-brand-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.15-1.46-3.27-3.4h1.96c.1 1.05 1.18 1.91 2.53 1.91 1.38 0 2.29-.9 2.29-1.95s-.8-1.78-2.67-2.22c-2.31-.56-3.75-1.74-3.75-3.57 0-1.83 1.4-3.1 3.11-3.45V3h2.67v1.9c1.55.32 2.76 1.43 2.91 3.09h-1.97c-.15-.83-.98-1.52-2.2-1.52-1.2 0-2 .88-2 1.83 0 1.25.96 1.69 2.68 2.14 2.55.67 3.73 1.88 3.73 3.65 0 1.95-1.49 3.25-3.35 3.5z"/></svg>
                </div>
                
                <h3 class="text-slate-400 text-xs font-mono uppercase tracking-wider mb-1">Valuación Total (MEP)</h3>
                
                <div class="flex items-baseline gap-2 mt-2">
                    <span class="text-4xl lg:text-5xl font-mono font-medium text-white tracking-tight tabular-nums" id="hero-usd-value">--</span>
                    <span class="text-sm font-bold bg-semantic-down/10 text-semantic-down border border-semantic-down/20 px-2 py-0.5 rounded-md" id="hero-badge-usd">-1.2%</span>
                </div>
                
                <div class="mt-3 flex items-center gap-2">
                    <span class="text-lg text-slate-400 font-sans">≈</span>
                    <span class="text-xl font-mono text-slate-300 tabular-nums" id="hero-ars-value">--</span>
                    <span class="text-xs font-bold text-semantic-up ml-1" id="hero-badge-ars">+45.3%</span>
                </div>
                
                <div class="mt-6 pt-4 border-t border-white/5 flex gap-4 text-xs">
                    <div>
                        <span class="block text-slate-500 mb-0.5">Precio Mercado (USD)</span>
                        <span class="text-white font-mono" id="hero-price-usd">--</span>
                    </div>
                    <div>
                        <span class="block text-slate-500 mb-0.5">Precio Mercado (ARS)</span>
                        <span class="text-white font-mono" id="hero-price-ars">--</span>
                    </div>
                </div>
            </div>

            <!-- Card 2: Holdings & Performance -->
            <div class="glass rounded-2xl p-6 lg:col-span-2">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-y-6 gap-x-8">
                    
                    <div>
                        <h4 class="text-slate-500 text-xs uppercase mb-1">Tenencia</h4>
                        <div class="text-2xl font-display font-bold text-white" id="hero-qty">--</div>
                        <div class="text-xs text-slate-500 mt-1">Certificados</div>
                    </div>

                    <div>
                        <h4 class="text-slate-500 text-xs uppercase mb-1">Invertido (Total)</h4>
                        <div class="font-mono text-white text-lg tabular-nums" id="hero-invested-usd">--</div>
                        <div class="text-xs font-mono text-slate-500 mt-0.5" id="hero-invested-ars">--</div>
                    </div>

                    <div>
                        <h4 class="text-slate-500 text-xs uppercase mb-1">PPC (Promedio)</h4>
                        <div class="font-mono text-white text-lg tabular-nums" id="hero-ppc-usd">--</div>
                        <div class="text-xs font-mono text-slate-500 mt-0.5" id="hero-ppc-ars">--</div>
                    </div>

                    <div>
                        <h4 class="text-slate-500 text-xs uppercase mb-1">Ganancia / Pérdida</h4>
                        <div class="font-mono text-lg tabular-nums text-semantic-down" id="hero-pnl-usd">--</div>
                        <div class="text-xs font-mono text-semantic-up mt-0.5" id="hero-pnl-ars">--</div>
                    </div>
                </div>

                <!-- Contextual Alert -->
                <div class="mt-6 p-3 rounded-lg bg-blue-500/10 border border-blue-500/20 flex items-start gap-3">
                    <svg class="w-5 h-5 text-blue-400 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <div class="text-xs text-slate-300 leading-relaxed">
                        <strong class="text-blue-300">Divergencia ARS/USD:</strong> Estás ganando en pesos por la suba del dólar MEP, pero tu posición en dólares duros está negativa porque el activo subyacente (QQQ) bajó desde tu compra.
                    </div>
                </div>
            </div>
        </section>

        <!-- 03. CONTROLS & TABS -->
        <section class="space-y-6">
            
            <!-- Cost Method Selector -->
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-2">
                    <span class="text-xs text-slate-400 font-mono uppercase tracking-wider">Criterio de Costeo:</span>
                    <!-- Tooltip trigger -->
                    <div class="group relative cursor-help">
                        <svg class="w-4 h-4 text-slate-600 hover:text-slate-400 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-slate-800 text-slate-300 text-xs p-3 rounded-lg border border-white/10 shadow-xl opacity-0 group-hover:opacity-100 transition pointer-events-none z-50">
                            Define qué lotes se "consumen" primero para calcular tu ganancia realizada y costos. No afecta impuestos, solo tu tablero.
                        </div>
                    </div>
                </div>

                <div class="bg-slate-900 p-1 rounded-lg border border-white/10 inline-flex overflow-x-auto max-w-full">
                    <button class="px-4 py-1.5 rounded text-xs font-medium bg-brand-primary text-white shadow-sm transition" onclick="updateMethod(this, 'PPP')">PPP (Promedio)</button>
                    <button class="px-4 py-1.5 rounded text-xs font-medium text-slate-400 hover:text-white transition" onclick="updateMethod(this, 'FIFO')">PEPS (FIFO)</button>
                    <button class="px-4 py-1.5 rounded text-xs font-medium text-slate-400 hover:text-white transition" onclick="updateMethod(this, 'LIFO')">UEPS (LIFO)</button>
                </div>
            </div>

            <!-- Tabs Header -->
            <div class="border-b border-white/10">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button onclick="switchTab('tab-lotes')" id="btn-tab-lotes" class="border-brand-primary text-brand-primary whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Compras (Lotes)
                    </button>
                    <button onclick="switchTab('tab-simulador')" id="btn-tab-simulador" class="border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Simulador Venta
                    </button>
                    <button onclick="switchTab('tab-calculo')" id="btn-tab-calculo" class="border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Cómo se calcula
                    </button>
                </nav>
            </div>

            <!-- TAB CONTENT 1: LOTES -->
            <div id="tab-lotes" class="tab-content animate-fade-in">
                <div class="glass rounded-xl overflow-hidden border border-white/10">
                    <div class="overflow-x-auto custom-scroll">
                        <table class="min-w-full divide-y divide-white/5">
                            <thead class="bg-slate-900/50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-mono font-medium text-slate-500 uppercase tracking-wider">Fecha</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-mono font-medium text-slate-500 uppercase tracking-wider">Cant</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-mono font-medium text-slate-500 uppercase tracking-wider">Precio Compra</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-mono font-medium text-brand-primary uppercase tracking-wider">TC Histórico</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-mono font-medium text-slate-500 uppercase tracking-wider">Invertido (USD)</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-mono font-medium text-slate-500 uppercase tracking-wider">Valor Hoy (USD)</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-mono font-medium text-slate-500 uppercase tracking-wider">Resultado</th>
                                    <th scope="col" class="relative px-6 py-3">
                                        <span class="sr-only">Acciones</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5 bg-transparent" id="lots-table-body">
                                <!-- JS Injection here -->
                            </tbody>
                            <tfoot class="bg-slate-900/80 font-bold border-t border-white/10">
                                <tr>
                                    <td class="px-6 py-4 text-xs text-white">TOTALES</td>
                                    <td class="px-6 py-4 text-right text-xs font-mono text-white tabular-nums" id="total-qty">--</td>
                                    <td class="px-6 py-4 text-right text-xs font-mono text-slate-500 tabular-nums">-</td>
                                    <td class="px-6 py-4 text-right text-xs font-mono text-slate-500 tabular-nums">-</td>
                                    <td class="px-6 py-4 text-right text-xs font-mono text-white tabular-nums" id="total-invested">--</td>
                                    <td class="px-6 py-4 text-right text-xs font-mono text-white tabular-nums" id="total-current">--</td>
                                    <td class="px-6 py-4 text-right text-xs font-mono tabular-nums" id="total-result">--</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="mt-2 text-right text-[10px] text-slate-500 italic">
                    * El "Valor Hoy (USD)" se calcula usando la cotización del CEDEAR en USD implícito o su equivalente en origen.
                </div>
            </div>

            <!-- TAB CONTENT 2: SIMULADOR -->
            <div id="tab-simulador" class="tab-content hidden animate-fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    <!-- INPUTS -->
                    <div class="lg:col-span-5 space-y-6">
                        <div class="glass p-6 rounded-xl">
                            <h3 class="text-sm font-display text-white mb-6">Configurar Venta</h3>
                            
                            <!-- Cantidad -->
                            <div class="space-y-2 mb-5">
                                <label class="text-xs font-mono text-slate-400 uppercase">Cantidad a vender</label>
                                <div class="relative">
                                    <input type="number" id="sim-qty" value="10" min="1" class="w-full bg-slate-950 border border-white/10 rounded-lg py-3 px-4 text-white font-mono focus:outline-none focus:border-brand-primary focus:ring-1 focus:ring-brand-primary transition tabular-nums">
                                    <button onclick="setMaxSim()" class="absolute right-2 top-2 px-2 py-1 bg-slate-800 text-[10px] text-brand-primary font-bold rounded hover:bg-slate-700 transition">MÁX</button>
                                </div>
                            </div>

                            <!-- Precio -->
                            <div class="space-y-2 mb-5">
                                <div class="flex justify-between">
                                    <label class="text-xs font-mono text-slate-400 uppercase">Precio Unitario (ARS)</label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" checked id="use-market-price" class="accent-brand-primary" onchange="toggleManualPrice()">
                                        <span class="text-[10px] text-slate-400">Usar precio mercado</span>
                                    </label>
                                </div>
                                <input type="text" id="sim-price" disabled class="w-full bg-slate-950/50 border border-white/10 rounded-lg py-3 px-4 text-slate-300 font-mono disabled:cursor-not-allowed transition tabular-nums">
                            </div>

                            <!-- Tipo de Cambio (Info) -->
                            <div class="p-3 bg-slate-900 rounded-lg border border-white/5 flex justify-between items-center">
                                <span class="text-xs text-slate-500">TC Aplicable (MEP Compra)</span>
                                <span class="text-xs font-mono text-white" id="sim-mep">--</span>
                            </div>

                            <button onclick="runSimulation()" class="w-full mt-6 bg-brand-primary hover:bg-brand-primary/90 text-white font-medium py-3 rounded-lg shadow-glow-sm transition flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                Recalcular Resultado
                            </button>
                        </div>
                    </div>

                    <!-- OUTPUTS -->
                    <div class="lg:col-span-7 space-y-4">
                        <div class="flex items-center justify-between">
                             <h3 class="text-sm font-display text-white">Proyección de Resultado</h3>
                             <span class="text-xs font-mono text-brand-primary bg-brand-primary/10 px-2 py-1 rounded border border-brand-primary/20" id="sim-method-badge">Método: PPP</span>
                        </div>

                        <!-- Card Producido -->
                        <div class="glass p-5 rounded-xl border-l-4 border-l-white flex justify-between items-center">
                            <div>
                                <div class="text-xs text-slate-500 uppercase font-mono mb-1">Total a Recibir (Producido)</div>
                                <div class="text-2xl font-mono text-white tabular-nums" id="sim-total-ars">--</div>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] text-slate-500 uppercase mb-1">Equivalente USD</div>
                                <div class="text-lg font-mono text-slate-300 tabular-nums" id="sim-total-usd">--</div>
                            </div>
                        </div>

                        <!-- Card Costo -->
                        <div class="glass p-5 rounded-xl border-l-4 border-l-slate-600 flex justify-between items-center">
                            <div>
                                <div class="text-xs text-slate-500 uppercase font-mono mb-1">Costo Asignado (Base)</div>
                                <div class="text-xl font-mono text-slate-300 tabular-nums" id="sim-cost-ars">--</div>
                                <div class="text-[10px] text-slate-500 mt-1">Costo de los lotes descargados</div>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] text-slate-500 uppercase mb-1">Costo Hist. USD</div>
                                <div class="text-lg font-mono text-slate-400 tabular-nums" id="sim-cost-usd">--</div>
                            </div>
                        </div>

                        <!-- Card Resultado -->
                        <div class="glass p-5 rounded-xl border-l-4 border-l-transparent relative overflow-hidden" id="sim-result-card">
                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-white/5 pointer-events-none"></div>
                            <div class="grid grid-cols-2 gap-8 relative z-10">
                                <div>
                                    <div class="text-xs text-slate-400 uppercase font-mono mb-1">Resultado Fiscal (ARS)</div>
                                    <div class="text-3xl font-mono font-bold text-white tabular-nums" id="sim-pnl-ars">--</div>
                                    <div class="text-xs mt-1 font-mono" id="sim-pct-ars">--</div>
                                </div>
                                <div class="text-right border-l border-white/10 pl-8">
                                    <div class="text-xs text-slate-400 uppercase font-mono mb-1">Resultado Real (USD)</div>
                                    <div class="text-3xl font-mono font-bold text-white tabular-nums" id="sim-pnl-usd">--</div>
                                    <div class="text-xs mt-1 font-mono" id="sim-pct-usd">--</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-xs text-slate-500 p-3 bg-slate-900/50 rounded-lg border border-white/5">
                            <span class="font-bold">Nota:</span> El resultado en USD se calcula comparando los dólares que podrías comprar hoy con el producido (MEP Compra) versus los dólares que te costó comprar esos papeles originalmente.
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB CONTENT 3: EDUCACION -->
            <div id="tab-calculo" class="tab-content hidden animate-fade-in">
                <div class="max-w-3xl glass p-8 rounded-2xl mx-auto space-y-8">
                    
                    <div>
                        <h3 class="text-xl font-display text-white mb-4">La Matemática del CEDEAR</h3>
                        <p class="text-slate-400 text-sm leading-relaxed">
                            Al operar CEDEARs en pesos, intervenimos dos variables: el precio del activo en EE.UU. y el tipo de cambio local (CCL/MEP). Argfolio separa ambos efectos para que sepas si ganaste plata de verdad o solo acompañaste la inflación.
                        </p>
                    </div>

                    <div class="space-y-6">
                        <div class="p-4 border border-white/10 rounded-lg bg-slate-900/50">
                            <h4 class="text-brand-primary font-mono text-xs font-bold uppercase mb-3">1. Tu costo en Dólares (Histórico)</h4>
                            <div class="font-mono text-sm text-slate-300 bg-black/30 p-3 rounded mb-2">
                                Costo_USD = Precio_Compra_ARS / TC_MEP_Vendedor(fecha_compra)
                            </div>
                            <p class="text-xs text-slate-500">
                                Usamos el MEP Vendedor histórico porque esos son los pesos que tuviste que poner para adquirir los dólares implícitos en el activo.
                            </p>
                        </div>

                        <div class="p-4 border border-white/10 rounded-lg bg-slate-900/50">
                            <h4 class="text-brand-primary font-mono text-xs font-bold uppercase mb-3">2. Tu valor actual en Dólares</h4>
                            <div class="font-mono text-sm text-slate-300 bg-black/30 p-3 rounded mb-2">
                                Valor_USD_Hoy = (Precio_Actual_ARS * Tenencia) / TC_MEP_Comprador(hoy)
                            </div>
                            <p class="text-xs text-slate-500">
                                Usamos MEP Comprador actual porque si vendieras tus CEDEARs en pesos hoy, ese es el tipo de cambio al que podrías recomprar dólares.
                            </p>
                        </div>

                         <div class="p-4 border border-emerald-500/10 rounded-lg bg-emerald-900/5">
                            <h4 class="text-emerald-400 font-mono text-xs font-bold uppercase mb-3">3. Resultado Real</h4>
                            <div class="font-mono text-sm text-emerald-100 bg-black/30 p-3 rounded mb-2">
                                PnL_USD = Valor_USD_Hoy - Costo_USD_Total
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </section>

    </main>

    <!-- LOGICA DEL PROTOTIPO -->
    <script>
        // --- MOCK DATA ---
        // Escenario: Compras viejas baratas en ARS (ganancia nom), pero caras en USD (pérdida real)
        const MARKET_DATA = {
            ticker: "QQQ",
            ars_price: 63450.00,
            usd_price_implicit: 52.88, // Valuado a MEP
            mep_buy: 1190.00,  // "Mostrador" te compra dolares
            mep_sell: 1215.00, // "Mostrador" te vende dolares
            last_update: "14:45"
        };

        const MOCK_LOTES = [
            { id: 1, date: '2023-06-15', qty: 20, price_ars: 18500.00, mep_historical: 490.00 }, // Muy ganadora en ARS y USD
            { id: 2, date: '2024-01-10', qty: 15, price_ars: 58000.00, mep_historical: 1120.00 }, // Empate ARS, Ganancia USD (mep subio poco, activo subio)
            { id: 3, date: '2024-03-01', qty: 30, price_ars: 65000.00, mep_historical: 1050.00 }, // Perdida ARS (compro caro), Perdida USD fuerte
        ];

        let currentMethod = 'PPP';

        // --- UTILS ---
        const fmtARS = (n) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(n);
        const fmtUSD = (n) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(n);
        const fmtNum = (n) => new Intl.NumberFormat('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);
        const fmtPct = (n) => {
            const sign = n > 0 ? '+' : '';
            return `${sign}${n.toFixed(2)}%`;
        };

        // --- CORE LOGIC ---
        
        function init() {
            renderHeader();
            calculatePortfolio();
            renderTable();
            initSimulator();
        }

        function renderHeader() {
            document.getElementById('mep-sell-display').textContent = `$${fmtNum(MARKET_DATA.mep_sell)}`;
            document.getElementById('mep-buy-display').textContent = `$${fmtNum(MARKET_DATA.mep_buy)}`;
            document.getElementById('hero-price-ars').textContent = fmtARS(MARKET_DATA.ars_price);
            document.getElementById('hero-price-usd').textContent = fmtUSD(MARKET_DATA.usd_price_implicit);
        }

        function calculatePortfolio() {
            let totalQty = 0;
            let totalInvestedARS = 0;
            let totalInvestedUSD = 0;

            MOCK_LOTES.forEach(lote => {
                totalQty += lote.qty;
                const invested_ars = lote.qty * lote.price_ars;
                // Costo USD histórico = ARS gastados / MEP Vendedor de ese día
                const invested_usd = invested_ars / lote.mep_historical;
                
                totalInvestedARS += invested_ars;
                totalInvestedUSD += invested_usd;
            });

            // Current Values
            const currentValARS = totalQty * MARKET_DATA.ars_price;
            // Valor USD Hoy = Cuantos dolares compro con mis pesos HOY (MEP Vendedor) 
            // O, si liquido, cuantos dolares recibo (MEP Comprador). Argfolio usa referencia de mercado.
            // Para "Valuacion" usamos el precio implicito directo * cantidad
            const currentValUSD = totalQty * MARKET_DATA.usd_price_implicit;

            // PnL
            const pnlARS = currentValARS - totalInvestedARS;
            const pnlPctARS = (pnlARS / totalInvestedARS) * 100;
            
            const pnlUSD = currentValUSD - totalInvestedUSD;
            const pnlPctUSD = (pnlUSD / totalInvestedUSD) * 100;

            // Render Hero
            document.getElementById('hero-usd-value').textContent = fmtUSD(currentValUSD);
            document.getElementById('hero-ars-value').textContent = fmtARS(currentValARS);
            
            updateBadge('hero-badge-usd', pnlPctUSD);
            updateBadge('hero-badge-ars', pnlPctARS);

            document.getElementById('hero-qty').textContent = totalQty;
            document.getElementById('hero-invested-usd').textContent = fmtUSD(totalInvestedUSD);
            document.getElementById('hero-invested-ars').textContent = fmtARS(totalInvestedARS);
            
            // PPC
            document.getElementById('hero-ppc-usd').textContent = fmtUSD(totalInvestedUSD / totalQty);
            document.getElementById('hero-ppc-ars').textContent = fmtARS(totalInvestedARS / totalQty);

            // PnL Cards
            const elPnlUsd = document.getElementById('hero-pnl-usd');
            elPnlUsd.textContent = `${fmtUSD(pnlUSD)} (${fmtPct(pnlPctUSD)})`;
            elPnlUsd.className = `font-mono text-lg tabular-nums ${pnlUSD >= 0 ? 'text-semantic-up' : 'text-semantic-down'}`;

            const elPnlArs = document.getElementById('hero-pnl-ars');
            elPnlArs.textContent = `${fmtARS(pnlARS)} (${fmtPct(pnlPctARS)})`;
            elPnlArs.className = `text-xs font-mono mt-0.5 ${pnlARS >= 0 ? 'text-semantic-up' : 'text-semantic-down'}`;
        }

        function updateBadge(id, pct) {
            const el = document.getElementById(id);
            el.textContent = fmtPct(pct);
            if(pct >= 0) {
                el.className = "text-sm font-bold bg-semantic-up/10 text-semantic-up border border-semantic-up/20 px-2 py-0.5 rounded-md tabular-nums";
            } else {
                el.className = "text-sm font-bold bg-semantic-down/10 text-semantic-down border border-semantic-down/20 px-2 py-0.5 rounded-md tabular-nums";
            }
        }

        function renderTable() {
            const tbody = document.getElementById('lots-table-body');
            tbody.innerHTML = '';

            let sumQty = 0;
            let sumInvUSD = 0;
            let sumCurUSD = 0;
            let sumResUSD = 0;

            MOCK_LOTES.forEach(lote => {
                const inv_ars = lote.qty * lote.price_ars;
                const inv_usd = inv_ars / lote.mep_historical;
                const cur_usd = lote.qty * MARKET_DATA.usd_price_implicit;
                const res_usd = cur_usd - inv_usd;

                sumQty += lote.qty;
                sumInvUSD += inv_usd;
                sumCurUSD += cur_usd;
                sumResUSD += res_usd;

                const tr = document.createElement('tr');
                tr.className = "hover:bg-white/5 transition group";
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-xs font-mono text-white">${lote.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-xs font-mono text-white">${lote.qty}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-xs font-mono text-slate-400">$${fmtNum(lote.price_ars)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-xs font-mono text-brand-primary">$${fmtNum(lote.mep_historical)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-xs font-mono text-slate-300">${fmtUSD(inv_usd)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-xs font-mono text-white">${fmtUSD(cur_usd)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-xs font-mono font-bold ${res_usd >= 0 ? 'text-semantic-up' : 'text-semantic-down'}">${fmtUSD(res_usd)}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="openSell(${lote.qty})" class="text-[10px] uppercase font-bold text-brand-primary opacity-0 group-hover:opacity-100 transition hover:underline">Vender</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Footer
            document.getElementById('total-qty').textContent = sumQty;
            document.getElementById('total-invested').textContent = fmtUSD(sumInvUSD);
            document.getElementById('total-current').textContent = fmtUSD(sumCurUSD);
            document.getElementById('total-result').textContent = fmtUSD(sumResUSD);
            const totalEl = document.getElementById('total-result');
            totalEl.className = `px-6 py-4 text-right text-xs font-mono tabular-nums font-bold ${sumResUSD >= 0 ? 'text-semantic-up' : 'text-semantic-down'}`;
        }

        // --- SIMULATOR LOGIC ---

        function initSimulator() {
            document.getElementById('sim-price').value = MARKET_DATA.ars_price;
            document.getElementById('sim-mep').textContent = `$${fmtNum(MARKET_DATA.mep_buy)}`;
            runSimulation();
        }

        function setMaxSim() {
            let total = MOCK_LOTES.reduce((acc, l) => acc + l.qty, 0);
            document.getElementById('sim-qty').value = total;
            runSimulation();
        }

        function toggleManualPrice() {
            const isAuto = document.getElementById('use-market-price').checked;
            const input = document.getElementById('sim-price');
            input.disabled = isAuto;
            if(isAuto) input.value = MARKET_DATA.ars_price;
            runSimulation();
        }

        function runSimulation() {
            const qty = parseFloat(document.getElementById('sim-qty').value) || 0;
            const priceArs = parseFloat(document.getElementById('sim-price').value) || 0;
            
            // 1. Producido (Revenue)
            const totalArs = qty * priceArs;
            // Si vendo en pesos, recibo pesos. Para saber cuantos USD son, divido por MEP COMPRA (el banco me compra los usd imaginarios)
            const totalUsd = totalArs / MARKET_DATA.mep_buy;

            document.getElementById('sim-total-ars').textContent = fmtARS(totalArs);
            document.getElementById('sim-total-usd').textContent = fmtUSD(totalUsd);

            // 2. Costo (Calculo simplificado PPP para el prototipo)
            // En una app real, aquí haríamos la lógica PEPS/UEPS recorriendo el array MOCK_LOTES
            let avgCostUSD = 0;
            let avgCostARS = 0;
            let totalHoldings = MOCK_LOTES.reduce((acc,l) => acc+l.qty, 0);
            
            MOCK_LOTES.forEach(l => {
                let weight = l.qty / totalHoldings;
                let costUsdUnit = (l.price_ars * l.qty / l.mep_historical) / l.qty;
                avgCostUSD += costUsdUnit * weight;
                avgCostARS += l.price_ars * weight;
            });

            const costArs = avgCostARS * qty;
            const costUsd = avgCostUSD * qty;

            document.getElementById('sim-cost-ars').textContent = fmtARS(costArs);
            document.getElementById('sim-cost-usd').textContent = fmtUSD(costUsd);

            // 3. Resultado
            const pnlArs = totalArs - costArs;
            const pnlUsd = totalUsd - costUsd;
            
            const pctArs = (pnlArs / costArs) * 100;
            const pctUsd = (pnlUsd / costUsd) * 100;

            renderSimResult('sim-pnl-ars', 'sim-pct-ars', pnlArs, pctArs, fmtARS);
            renderSimResult('sim-pnl-usd', 'sim-pct-usd', pnlUsd, pctUsd, fmtUSD);
            
            // Border color del card
            const card = document.getElementById('sim-result-card');
            if(pnlUsd >= 0) {
                card.className = "glass p-5 rounded-xl border-l-4 border-l-semantic-up relative overflow-hidden";
            } else {
                card.className = "glass p-5 rounded-xl border-l-4 border-l-semantic-down relative overflow-hidden";
            }
        }

        function renderSimResult(idVal, idPct, val, pct, fmt) {
            const elVal = document.getElementById(idVal);
            const elPct = document.getElementById(idPct);
            
            elVal.textContent = fmt(val);
            elPct.textContent = fmtPct(pct);
            
            const color = val >= 0 ? 'text-semantic-up' : 'text-semantic-down';
            elVal.className = `text-3xl font-mono font-bold tabular-nums ${color}`;
            elPct.className = `text-xs mt-1 font-mono font-bold ${color}`;
        }

        // --- UI HANDLERS ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            // Reset borders
            ['tab-lotes', 'tab-simulador', 'tab-calculo'].forEach(id => {
                const btn = document.getElementById('btn-' + id);
                btn.className = "border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors";
            });

            // Set active
            const activeBtn = document.getElementById('btn-' + tabId);
            activeBtn.className = "border-brand-primary text-brand-primary whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors";
        }

        function updateMethod(btn, method) {
            // Visual reset
            btn.parentNode.querySelectorAll('button').forEach(b => {
                b.className = "px-4 py-1.5 rounded text-xs font-medium text-slate-400 hover:text-white transition";
            });
            // Active state
            btn.className = "px-4 py-1.5 rounded text-xs font-medium bg-brand-primary text-white shadow-sm transition";
            
            currentMethod = method;
            document.getElementById('sim-method-badge').textContent = `Método: ${method}`;
            // Re-run simulation (Mocked logic would change here)
            runSimulation();
        }
        
        function openSell(qty) {
            switchTab('tab-simulador');
            document.getElementById('sim-qty').value = qty;
            runSimulation();
        }

        // Init
        init();

    </script>
</body>
</html>