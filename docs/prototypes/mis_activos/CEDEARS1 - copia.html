<!DOCTYPE html>
<html lang="es" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invesco QQQ Trust (QQQ) — Argfolio</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            primary: '#6366f1',
                            accent: '#0ea5e9',
                        },
                        semantic: {
                            up: '#10b981',
                            down: '#f43f5e',
                            warn: '#f59e0b',
                            info: '#3b82f6',
                        }
                    },
                    boxShadow: {
                        'glow': '0 0 20px -5px rgba(99, 102, 241, 0.3)',
                        'glow-sm': '0 0 10px -2px rgba(99, 102, 241, 0.2)',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --bg-app: #0B1121;
            --glass-panel: rgba(30, 41, 59, 0.4);
            --border-subtle: rgba(255,255,255,0.08);
        }
        body {
            background-color: var(--bg-app);
            color: #F8FAFC;
        }
        .glass {
            background: var(--glass-panel);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-subtle);
        }
        .custom-scroll::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.02);
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .tabular-nums {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }
        /* Hierarchy Utilities */
        .text-secondary-row {
            font-size: 0.75rem; /* text-xs */
            color: #64748B; /* slate-500 */
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 glass border-b border-white/5 px-6 py-4 flex justify-between items-center mb-8">
        <div class="flex items-center gap-3">
            <svg class="w-6 h-6 text-brand-primary" viewBox="0 0 40 40" fill="none">
                <path d="M20 4L4 36H12L20 20L28 36H36L20 4Z" fill="currentColor"/>
                <circle cx="20" cy="14" r="3" class="text-white" fill="currentColor"/>
            </svg>
            <span class="font-display font-bold tracking-wide text-sm text-slate-300">Argfolio / Mis Activos</span>
        </div>
        <div class="flex items-center gap-4">
            <div class="h-8 w-8 rounded-full bg-brand-primary/20 text-brand-primary flex items-center justify-center font-bold text-xs">JM</div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">

        <!-- 01. HEADER -->
        <header class="space-y-6">
            <nav class="flex items-center text-xs text-slate-500 font-mono space-x-2">
                <span class="hover:text-white cursor-pointer transition">Mis Activos</span>
                <span>/</span>
                <span class="hover:text-white cursor-pointer transition">CEDEARs</span>
                <span>/</span>
                <span class="text-brand-primary font-bold">QQQ</span>
            </nav>

            <div class="flex flex-col md:flex-row md:items-start justify-between gap-6">
                <div class="flex items-start gap-5">
                    <div class="w-16 h-16 rounded-2xl bg-slate-800 border border-white/10 flex items-center justify-center shadow-lg shadow-indigo-500/10 shrink-0">
                        <span class="font-display font-bold text-2xl text-white tracking-tighter">QQQ</span>
                    </div>
                    <div>
                        <h1 class="text-3xl md:text-4xl font-display font-bold text-white tracking-tight">
                            Invesco QQQ Trust
                        </h1>
                        <div class="flex flex-wrap items-center gap-3 mt-2 text-sm text-slate-400">
                            <span class="bg-slate-800/50 border border-white/10 px-2 py-0.5 rounded text-xs font-medium text-slate-300">CEDEAR</span>
                            <span>Ratio 20:1</span>
                            <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                            <span>Nasdaq-100</span>
                        </div>
                    </div>
                </div>

                <!-- Market Data / Chips -->
                <div class="flex flex-col items-end gap-2">
                    <div class="flex gap-2">
                        <!-- MEP VENTA es el clave para convertir ARS -> USD -->
                        <div class="px-3 py-1.5 rounded-lg bg-slate-900 border border-brand-primary/30 text-xs font-mono text-slate-300 flex items-center gap-2 shadow-[0_0_10px_rgba(99,102,241,0.1)]" title="TC MEP Vendedor (Referencia para comprar USD)">
                            <span class="text-brand-primary font-bold">MEP VENTA</span>
                            <span class="text-white font-bold" id="mep-sell-display">...</span>
                        </div>
                        <div class="px-3 py-1.5 rounded-lg bg-slate-900 border border-white/10 text-xs font-mono text-slate-500 flex items-center gap-2 opacity-70">
                            <span>MEP COMPRA</span>
                            <span class="text-slate-300" id="mep-buy-display">...</span>
                        </div>
                    </div>
                    <span class="text-[10px] text-slate-600 uppercase tracking-wider">Act. 14:30hs · Mercado Abierto</span>
                </div>
            </div>
        </header>

        <!-- 02. HERO CARDS -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Card 1: Valuation (ARS Primary) -->
            <div class="glass rounded-2xl p-6 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition duration-500">
                    <svg class="w-24 h-24 text-brand-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.15-1.46-3.27-3.4h1.96c.1 1.05 1.18 1.91 2.53 1.91 1.38 0 2.29-.9 2.29-1.95s-.8-1.78-2.67-2.22c-2.31-.56-3.75-1.74-3.75-3.57 0-1.83 1.4-3.1 3.11-3.45V3h2.67v1.9c1.55.32 2.76 1.43 2.91 3.09h-1.97c-.15-.83-.98-1.52-2.2-1.52-1.2 0-2 .88-2 1.83 0 1.25.96 1.69 2.68 2.14 2.55.67 3.73 1.88 3.73 3.65 0 1.95-1.49 3.25-3.35 3.5z"/></svg>
                </div>
                
                <h3 class="text-slate-400 text-xs font-mono uppercase tracking-wider mb-1">Valuación Total (ARS)</h3>
                
                <!-- Primary: ARS -->
                <div class="flex items-baseline gap-2 mt-2">
                    <span class="text-4xl lg:text-4xl font-mono font-medium text-white tracking-tight tabular-nums" id="hero-ars-value">--</span>
                    <span class="text-sm font-bold px-2 py-0.5 rounded-md tabular-nums" id="hero-badge-ars">--</span>
                </div>
                
                <!-- Secondary: USD (Valuado a MEP Venta) -->
                <div class="mt-3 flex items-center gap-2">
                    <span class="text-lg text-slate-500 font-sans">≈</span>
                    <span class="text-xl font-mono text-slate-400 tabular-nums" id="hero-usd-value">--</span>
                    <span class="text-xs font-bold px-1.5 py-0.5 rounded tabular-nums" id="hero-badge-usd">--</span>
                    <span class="text-[10px] text-slate-600 uppercase border border-white/10 px-1 rounded">MEP</span>
                </div>
                
                <div class="mt-6 pt-4 border-t border-white/5 flex gap-8 text-xs">
                    <div>
                        <span class="block text-slate-500 mb-0.5 uppercase tracking-wider text-[10px]">Precio (ARS)</span>
                        <span class="text-white font-mono" id="hero-price-ars">--</span>
                    </div>
                    <div>
                        <span class="block text-slate-500 mb-0.5 uppercase tracking-wider text-[10px]">Precio (USD)</span>
                        <span class="text-slate-400 font-mono" id="hero-price-usd">--</span>
                    </div>
                </div>
            </div>

            <!-- Card 2: Metrics (Dual Currency) -->
            <div class="glass rounded-2xl p-6 lg:col-span-2 flex flex-col justify-between">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-y-8 gap-x-8">
                    
                    <!-- Tenencia -->
                    <div>
                        <h4 class="text-slate-500 text-[10px] uppercase font-bold tracking-wider mb-2">Tenencia</h4>
                        <div class="text-3xl font-display font-bold text-white" id="hero-qty">--</div>
                        <div class="text-xs text-slate-500 mt-1">Certificados</div>
                    </div>

                    <!-- Invertido (Histórico) -->
                    <div>
                        <h4 class="text-slate-500 text-[10px] uppercase font-bold tracking-wider mb-2">Invertido (Total)</h4>
                        <div class="font-mono text-lg text-white tabular-nums" id="hero-invested-ars">--</div>
                        <div class="font-mono text-xs text-slate-500 tabular-nums flex items-center gap-1">
                            <span id="hero-invested-usd">--</span>
                            <span class="text-[9px] text-slate-600 border border-slate-700 px-1 rounded">HIST</span>
                        </div>
                    </div>

                    <!-- PPC -->
                    <div>
                        <h4 class="text-slate-500 text-[10px] uppercase font-bold tracking-wider mb-2">PPC (Promedio)</h4>
                        <div class="font-mono text-lg text-white tabular-nums" id="hero-ppc-ars">--</div>
                        <div class="font-mono text-xs text-slate-500 tabular-nums" id="hero-ppc-usd">--</div>
                    </div>

                    <!-- PnL (Doble) -->
                    <div>
                        <h4 class="text-slate-500 text-[10px] uppercase font-bold tracking-wider mb-2">Resultado</h4>
                        <!-- ARS PnL -->
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-slate-500 font-mono w-6">ARS</span>
                            <span class="font-mono text-lg tabular-nums font-medium" id="hero-pnl-ars">--</span>
                        </div>
                        <!-- USD PnL -->
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-[10px] text-slate-500 font-mono w-6">USD</span>
                            <span class="font-mono text-sm tabular-nums" id="hero-pnl-usd">--</span>
                        </div>
                    </div>
                </div>

                <!-- DIVERGENCE ALERT (Conditional JS) -->
                <div id="divergence-alert" class="hidden mt-4 p-3 rounded-lg bg-indigo-500/10 border border-indigo-500/20 items-start gap-3">
                    <svg class="w-5 h-5 text-indigo-400 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <div class="text-xs text-slate-300 leading-relaxed">
                        <strong class="text-indigo-300">Divergencia ARS/USD:</strong> Estás ganando en pesos (nominal) por la suba del dólar MEP, pero tu posición real en dólares cae por el activo subyacente.
                    </div>
                </div>
            </div>
        </section>

        <!-- 03. TABS & CONTENT -->
        <section class="space-y-6">
            
            <!-- Controls -->
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                 <!-- Tabs Header -->
                <nav class="flex space-x-6 border-b border-white/10 w-full md:w-auto" aria-label="Tabs">
                    <button onclick="switchTab('tab-lotes')" id="btn-tab-lotes" class="border-brand-primary text-brand-primary py-3 px-1 border-b-2 font-medium text-sm transition-colors">
                        Compras (Lotes)
                    </button>
                    <button onclick="switchTab('tab-simulador')" id="btn-tab-simulador" class="border-transparent text-slate-400 hover:text-slate-200 py-3 px-1 border-b-2 font-medium text-sm transition-colors">
                        Simulador Venta
                    </button>
                    <button onclick="switchTab('tab-calculo')" id="btn-tab-calculo" class="border-transparent text-slate-400 hover:text-slate-200 py-3 px-1 border-b-2 font-medium text-sm transition-colors">
                        Cómo se calcula
                    </button>
                </nav>
            </div>

            <!-- TAB 1: LOTES -->
            <div id="tab-lotes" class="tab-content animate-fade-in">
                <div class="glass rounded-xl overflow-hidden border border-white/10">
                    <div class="overflow-x-auto custom-scroll">
                        <table class="min-w-full divide-y divide-white/5">
                            <thead class="bg-slate-900/50">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-mono font-medium text-slate-500 uppercase">Fecha</th>
                                    <th class="px-6 py-4 text-right text-xs font-mono font-medium text-slate-500 uppercase">Cant</th>
                                    <th class="px-6 py-4 text-right text-xs font-mono font-medium text-slate-500 uppercase">
                                        Precio Compra<br>
                                        <span class="text-[9px] normal-case opacity-50">(Unitario)</span>
                                    </th>
                                    <th class="px-6 py-4 text-right text-xs font-mono font-medium text-slate-500 uppercase">TC Hist.</th>
                                    <th class="px-6 py-4 text-right text-xs font-mono font-medium text-slate-500 uppercase">
                                        Invertido<br>
                                        <span class="text-[9px] normal-case opacity-50">(Total Lote)</span>
                                    </th>
                                    <th class="px-6 py-4 text-right text-xs font-mono font-medium text-slate-500 uppercase">
                                        Valor Hoy<br>
                                        <span class="text-[9px] normal-case opacity-50">(Valuado MEP)</span>
                                    </th>
                                    <th class="px-6 py-4 text-right text-xs font-mono font-medium text-slate-500 uppercase">Resultado</th>
                                    <th class="relative px-6 py-4"><span class="sr-only">Acciones</span></th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5 bg-transparent" id="lots-table-body">
                                <!-- JS Injection -->
                            </tbody>
                            <tfoot class="bg-slate-900/80 font-bold border-t border-white/10">
                                <tr>
                                    <td class="px-6 py-4 text-xs text-white">TOTALES</td>
                                    <td class="px-6 py-4 text-right text-xs font-mono text-white tabular-nums" id="tbl-total-qty">--</td>
                                    <td class="px-6 py-4"></td>
                                    <td class="px-6 py-4"></td>
                                    <td class="px-6 py-4 text-right">
                                        <div class="text-xs font-mono text-white tabular-nums" id="tbl-total-inv-ars">--</div>
                                        <div class="text-secondary-row" id="tbl-total-inv-usd">--</div>
                                    </td>
                                    <td class="px-6 py-4 text-right">
                                        <div class="text-xs font-mono text-white tabular-nums" id="tbl-total-val-ars">--</div>
                                        <div class="text-secondary-row" id="tbl-total-val-usd">--</div>
                                    </td>
                                    <td class="px-6 py-4 text-right">
                                        <div class="text-xs font-mono tabular-nums" id="tbl-total-res-ars">--</div>
                                        <div class="text-[10px] font-mono tabular-nums" id="tbl-total-res-usd">--</div>
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- TAB 2: SIMULADOR -->
            <div id="tab-simulador" class="tab-content hidden animate-fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    <!-- Configuración -->
                    <div class="lg:col-span-5 space-y-6">
                        <div class="glass p-6 rounded-xl border border-white/10">
                            <h3 class="text-sm font-display text-white mb-6">Configurar Venta</h3>
                            
                            <!-- Cantidad -->
                            <div class="space-y-2 mb-5">
                                <label class="text-xs font-mono text-slate-400 uppercase">Cantidad (Nominales)</label>
                                <div class="relative">
                                    <input type="number" id="sim-qty" value="10" min="1" step="1" class="w-full bg-slate-950 border border-white/10 rounded-lg py-3 px-4 text-white font-mono focus:outline-none focus:border-brand-primary focus:ring-1 focus:ring-brand-primary transition tabular-nums">
                                    <button onclick="setMaxSim()" class="absolute right-2 top-2 px-2 py-1 bg-slate-800 text-[10px] text-brand-primary font-bold rounded hover:bg-slate-700 transition">MÁX</button>
                                </div>
                            </div>

                            <!-- Precio -->
                            <div class="space-y-2 mb-5">
                                <div class="flex justify-between">
                                    <label class="text-xs font-mono text-slate-400 uppercase">Precio Unitario (ARS)</label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" checked id="use-market-price" class="accent-brand-primary" onchange="toggleManualPrice()">
                                        <span class="text-[10px] text-slate-400">Usar precio mercado</span>
                                    </label>
                                </div>
                                <input type="text" id="sim-price" disabled class="w-full bg-slate-950/50 border border-white/10 rounded-lg py-3 px-4 text-slate-300 font-mono disabled:cursor-not-allowed transition tabular-nums">
                            </div>
                            
                            <!-- Método -->
                            <div class="space-y-3 mb-6">
                                <label class="text-xs font-mono text-slate-400 uppercase">Método de Descarga</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="setSimMethod('PPP')" class="sim-method-btn px-3 py-2 rounded-md text-xs font-medium border transition bg-brand-primary/20 border-brand-primary text-white" data-method="PPP">PPP (Promedio)</button>
                                    <button onclick="setSimMethod('FIFO')" class="sim-method-btn px-3 py-2 rounded-md text-xs font-medium border border-white/10 text-slate-400 hover:text-white transition" data-method="FIFO">PEPS (FIFO)</button>
                                    <button onclick="setSimMethod('LIFO')" class="sim-method-btn px-3 py-2 rounded-md text-xs font-medium border border-white/10 text-slate-400 hover:text-white transition" data-method="LIFO">UEPS (LIFO)</button>
                                    <button onclick="setSimMethod('CHEAPEST')" class="sim-method-btn px-3 py-2 rounded-md text-xs font-medium border border-white/10 text-slate-400 hover:text-white transition" data-method="CHEAPEST">Baratos primero</button>
                                </div>
                            </div>

                            <div class="p-3 bg-slate-900 rounded-lg border border-white/5 flex justify-between items-center">
                                <span class="text-xs text-slate-500">TC Aplicable (MEP Venta)</span>
                                <span class="text-xs font-mono text-white" id="sim-mep">--</span>
                            </div>

                            <button onclick="runSimulation()" class="w-full mt-6 bg-brand-primary hover:bg-brand-primary/90 text-white font-medium py-3 rounded-lg shadow-glow-sm transition flex items-center justify-center gap-2">
                                Recalcular
                            </button>
                        </div>
                    </div>

                    <!-- Resultados -->
                    <div class="lg:col-span-7 space-y-4">
                        <div class="flex items-center justify-between">
                             <h3 class="text-sm font-display text-white">Proyección de Resultado</h3>
                        </div>

                        <!-- Card Producido -->
                        <div class="glass p-5 rounded-xl border-l-4 border-l-white flex justify-between items-center">
                            <div>
                                <div class="text-xs text-slate-500 uppercase font-mono mb-1">Total a Recibir (Producido)</div>
                                <div class="text-2xl font-mono text-white tabular-nums" id="sim-revenue-ars">--</div>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] text-slate-500 uppercase mb-1">Equivalente USD</div>
                                <div class="text-lg font-mono text-slate-400 tabular-nums" id="sim-revenue-usd">--</div>
                            </div>
                        </div>

                        <!-- Card Costo -->
                        <div class="glass p-5 rounded-xl border-l-4 border-l-slate-600">
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <div class="text-xs text-slate-500 uppercase font-mono mb-1">Costo Asignado (Base)</div>
                                    <div class="text-xl font-mono text-slate-300 tabular-nums" id="sim-cost-ars">--</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-slate-500 uppercase mb-1">Costo Hist. USD</div>
                                    <div class="text-lg font-mono text-slate-400 tabular-nums" id="sim-cost-usd">--</div>
                                </div>
                            </div>
                            
                            <!-- Lista lotes consumidos -->
                            <div class="border-t border-white/10 pt-3">
                                <div class="text-[10px] text-slate-500 uppercase mb-2">Lotes Consumidos:</div>
                                <ul class="space-y-1 max-h-32 overflow-y-auto custom-scroll" id="sim-lots-list">
                                    <!-- JS Fill -->
                                </ul>
                            </div>
                        </div>

                        <!-- Card Resultado -->
                        <div class="glass p-5 rounded-xl border-l-4 border-l-transparent relative overflow-hidden" id="sim-result-card">
                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-white/5 pointer-events-none"></div>
                            <div class="grid grid-cols-2 gap-8 relative z-10">
                                <div>
                                    <div class="text-xs text-slate-400 uppercase font-mono mb-1">Resultado Fiscal (ARS)</div>
                                    <div class="text-2xl font-mono font-bold text-white tabular-nums" id="sim-pnl-ars">--</div>
                                    <div class="text-xs mt-1 font-mono" id="sim-pct-ars">--</div>
                                </div>
                                <div class="text-right border-l border-white/10 pl-8">
                                    <div class="text-xs text-slate-400 uppercase font-mono mb-1">Resultado Real (USD)</div>
                                    <div class="text-2xl font-mono font-bold text-white tabular-nums" id="sim-pnl-usd">--</div>
                                    <div class="text-xs mt-1 font-mono" id="sim-pct-usd">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 3: EDUCACION -->
            <div id="tab-calculo" class="tab-content hidden animate-fade-in">
                <div class="max-w-3xl glass p-8 rounded-2xl mx-auto space-y-8">
                    <div>
                        <h3 class="text-xl font-display text-white mb-4">Matemática del CEDEAR en Argfolio</h3>
                        <p class="text-slate-400 text-sm leading-relaxed">
                            Aunque operás en pesos, tu resultado real depende del dólar. Para ser consistentes contablemente, usamos siempre la punta <strong>VENDEDORA</strong> del MEP (el precio al que el mercado te vende dólares) para las conversiones de poder de compra.
                        </p>
                    </div>

                    <div class="space-y-6 font-mono text-xs">
                        <div class="p-4 bg-slate-900/50 border border-white/10 rounded-lg">
                            <div class="text-brand-primary font-bold mb-2">1. INVERTIDO (COSTO)</div>
                            <div class="text-slate-300 mb-1">Invertido_ARS = Σ(Cantidad * Precio_Compra_ARS)</div>
                            <div class="text-slate-500">Invertido_USD = Σ(Invertido_ARS / MEP_Venta_Histórico)</div>
                        </div>

                        <div class="p-4 bg-slate-900/50 border border-white/10 rounded-lg">
                            <div class="text-brand-primary font-bold mb-2">2. VALOR HOY</div>
                            <div class="text-slate-300 mb-1">Valor_ARS = Tenencia * Precio_Actual_ARS</div>
                            <div class="text-slate-500">Valor_USD = Valor_ARS / MEP_Venta_Hoy</div>
                        </div>

                        <div class="p-4 bg-slate-900/50 border border-white/10 rounded-lg">
                            <div class="text-brand-primary font-bold mb-2">3. RESULTADO (PnL)</div>
                            <div class="text-slate-300 mb-1">PnL_ARS = Valor_ARS - Invertido_ARS</div>
                            <div class="text-slate-500">PnL_USD = Valor_USD - Invertido_USD</div>
                        </div>
                    </div>
                    
                    <div class="p-4 rounded bg-amber-500/10 border border-amber-500/20 text-xs text-amber-200">
                        <strong>¿Por qué MEP Venta?</strong> Porque si tenés Pesos y querés pasarte a Dólares, debés comprarlos al precio de venta del mercado. Esa es la tasa real de conversión de tu capital en pesos a moneda dura.
                    </div>
                </div>
            </div>

        </section>
    </main>

    <script>
        // --- DATA ---
        // Escenario: MEP subió mucho (ganás en ARS), pero activo bajó en USD (perdessa en USD)
        const MARKET_DATA = {
            ticker: "QQQ",
            ars_price: 63450.00,
            mep_sell: 1215.00, // Usamos este para convertir ARS -> USD
            mep_buy: 1185.00,  // Informativo
            last_update: "14:45"
        };

        // Lotes históricos
        const MOCK_LOTES = [
            { id: 1, date: '2023-06-15', qty: 20, price_ars: 18500.00, mep_hist_sell: 490.00 },
            { id: 2, date: '2024-01-10', qty: 15, price_ars: 58000.00, mep_hist_sell: 1120.00 },
            { id: 3, date: '2024-03-01', qty: 30, price_ars: 68000.00, mep_hist_sell: 1050.00 }, // Compró caro en ARS
        ];

        let simMethod = 'PPP';

        // --- FORMATTERS ---
        const fmtARS = (n) => `$ ${new Intl.NumberFormat('es-AR', { minimumFractionDigits: 2 }).format(n)} ARS`;
        const fmtUSD = (n) => `US$ ${new Intl.NumberFormat('en-US', { minimumFractionDigits: 2 }).format(n)}`;
        const fmtNum = (n) => new Intl.NumberFormat('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);
        const fmtPct = (n) => {
            const sign = n > 0 ? '+' : '';
            return `${sign}${n.toFixed(2)}%`;
        };

        // --- MAIN LOGIC ---

        function init() {
            renderHeader();
            calculatePortfolio();
            renderTable();
            initSimulator();
        }

        function renderHeader() {
            document.getElementById('mep-sell-display').textContent = `$${fmtNum(MARKET_DATA.mep_sell)}`;
            document.getElementById('mep-buy-display').textContent = `$${fmtNum(MARKET_DATA.mep_buy)}`;
            
            // Hero Prices
            document.getElementById('hero-price-ars').textContent = fmtARS(MARKET_DATA.ars_price);
            // USD Price derived from MEP Sell
            const usdImpl = MARKET_DATA.ars_price / MARKET_DATA.mep_sell;
            document.getElementById('hero-price-usd').textContent = fmtUSD(usdImpl);
        }

        function calculatePortfolio() {
            let totalQty = 0;
            let invARS = 0;
            let invUSD = 0;

            MOCK_LOTES.forEach(l => {
                totalQty += l.qty;
                const cost_ars = l.qty * l.price_ars;
                const cost_usd = cost_ars / l.mep_hist_sell; // MEP Venta Histórico
                invARS += cost_ars;
                invUSD += cost_usd;
            });

            // Values Today
            const valARS = totalQty * MARKET_DATA.ars_price;
            const valUSD = valARS / MARKET_DATA.mep_sell; // MEP Venta Hoy

            // PnL
            const pnlARS = valARS - invARS;
            const pctARS = (pnlARS / invARS) * 100;
            
            const pnlUSD = valUSD - invUSD;
            const pctUSD = (pnlUSD / invUSD) * 100;

            // --- RENDER HERO ---
            
            // 1. Valuation Card
            document.getElementById('hero-ars-value').textContent = fmtARS(valARS);
            updateBadge('hero-badge-ars', pctARS);
            
            document.getElementById('hero-usd-value').textContent = fmtUSD(valUSD);
            updateBadge('hero-badge-usd', pctUSD);

            // 2. Metrics Card
            document.getElementById('hero-qty').textContent = totalQty;
            
            // Invested
            document.getElementById('hero-invested-ars').textContent = fmtARS(invARS);
            document.getElementById('hero-invested-usd').textContent = fmtUSD(invUSD);

            // PPC
            document.getElementById('hero-ppc-ars').textContent = fmtARS(invARS / totalQty);
            document.getElementById('hero-ppc-usd').textContent = fmtUSD(invUSD / totalQty);

            // Result
            renderDualPnL('hero-pnl-ars', pnlARS, pctARS, fmtARS);
            renderDualPnL('hero-pnl-usd', pnlUSD, pctUSD, fmtUSD);

            // Divergence Alert
            const alertBox = document.getElementById('divergence-alert');
            // Show if signs differ (one pos, one neg)
            if ((pnlARS > 0 && pnlUSD < 0) || (pnlARS < 0 && pnlUSD > 0)) {
                alertBox.classList.remove('hidden');
                alertBox.classList.add('flex');
            } else {
                alertBox.classList.add('hidden');
            }
        }

        function renderDualPnL(id, val, pct, fmtFn) {
            const el = document.getElementById(id);
            const color = val >= 0 ? 'text-semantic-up' : 'text-semantic-down';
            el.textContent = `${fmtFn(val)} (${fmtPct(pct)})`;
            el.className = `font-mono tabular-nums ${color} ${id.includes('usd') ? 'text-xs' : 'text-lg font-medium'}`;
        }

        function updateBadge(id, pct) {
            const el = document.getElementById(id);
            el.textContent = fmtPct(pct);
            const colorClass = pct >= 0 
                ? "bg-semantic-up/10 text-semantic-up border border-semantic-up/20" 
                : "bg-semantic-down/10 text-semantic-down border border-semantic-down/20";
            el.className = `text-xs font-bold px-2 py-0.5 rounded-md tabular-nums ${colorClass}`;
        }

        function renderTable() {
            const tbody = document.getElementById('lots-table-body');
            tbody.innerHTML = '';

            let tQty=0, tInvArs=0, tInvUsd=0, tValArs=0, tValUsd=0, tResArs=0, tResUsd=0;

            MOCK_LOTES.forEach(l => {
                const iArs = l.qty * l.price_ars;
                const iUsd = iArs / l.mep_hist_sell;
                
                const vArs = l.qty * MARKET_DATA.ars_price;
                const vUsd = vArs / MARKET_DATA.mep_sell;

                const rArs = vArs - iArs;
                const rUsd = vUsd - iUsd;

                // Totals
                tQty += l.qty; tInvArs+=iArs; tInvUsd+=iUsd; tValArs+=vArs; tValUsd+=vUsd; tResArs+=rArs; tResUsd+=rUsd;

                const tr = document.createElement('tr');
                tr.className = "hover:bg-white/5 transition group";
                tr.innerHTML = `
                    <td class="px-6 py-4 text-xs font-mono text-white">${l.date}</td>
                    <td class="px-6 py-4 text-right text-xs font-mono text-white">${l.qty}</td>
                    <!-- Precio Compra -->
                    <td class="px-6 py-4 text-right">
                        <div class="text-xs font-mono text-white">$ ${fmtNum(l.price_ars)}</div>
                        <div class="text-secondary-row">US$ ${fmtNum(l.price_ars / l.mep_hist_sell)}</div>
                    </td>
                    <!-- TC Hist -->
                    <td class="px-6 py-4 text-right text-xs font-mono text-brand-primary">$ ${fmtNum(l.mep_hist_sell)}</td>
                    <!-- Invertido -->
                    <td class="px-6 py-4 text-right">
                        <div class="text-xs font-mono text-slate-300">${fmtARS(iArs)}</div>
                        <div class="text-secondary-row">${fmtUSD(iUsd)}</div>
                    </td>
                    <!-- Valor Hoy -->
                    <td class="px-6 py-4 text-right">
                        <div class="text-xs font-mono text-white">${fmtARS(vArs)}</div>
                        <div class="text-secondary-row">${fmtUSD(vUsd)}</div>
                    </td>
                    <!-- Resultado -->
                    <td class="px-6 py-4 text-right">
                        <div class="text-xs font-mono ${rArs>=0?'text-semantic-up':'text-semantic-down'}">${fmtARS(rArs)}</div>
                        <div class="text-[10px] font-mono ${rUsd>=0?'text-semantic-up':'text-semantic-down'}">${fmtUSD(rUsd)}</div>
                    </td>
                    <td class="px-6 py-4 text-right">
                         <button onclick="openSell(${l.qty})" class="text-[10px] uppercase font-bold text-brand-primary opacity-0 group-hover:opacity-100 hover:underline">Vender</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Update Footer Totals
            document.getElementById('tbl-total-qty').textContent = tQty;
            document.getElementById('tbl-total-inv-ars').textContent = fmtARS(tInvArs);
            document.getElementById('tbl-total-inv-usd').textContent = fmtUSD(tInvUsd);
            document.getElementById('tbl-total-val-ars').textContent = fmtARS(tValArs);
            document.getElementById('tbl-total-val-usd').textContent = fmtUSD(tValUsd);
            
            const rArsEl = document.getElementById('tbl-total-res-ars');
            rArsEl.textContent = fmtARS(tResArs);
            rArsEl.className = `text-xs font-mono tabular-nums ${tResArs>=0?'text-semantic-up':'text-semantic-down'}`;
            
            const rUsdEl = document.getElementById('tbl-total-res-usd');
            rUsdEl.textContent = fmtUSD(tResUsd);
            rUsdEl.className = `text-[10px] font-mono tabular-nums ${tResUsd>=0?'text-semantic-up':'text-semantic-down'}`;
        }

        // --- SIMULATOR ---

        function initSimulator() {
            document.getElementById('sim-price').value = MARKET_DATA.ars_price;
            document.getElementById('sim-mep').textContent = `$${fmtNum(MARKET_DATA.mep_sell)}`;
            runSimulation();
        }

        function setMaxSim() {
            let total = MOCK_LOTES.reduce((acc, l) => acc + l.qty, 0);
            document.getElementById('sim-qty').value = total;
            runSimulation();
        }

        function toggleManualPrice() {
            const isAuto = document.getElementById('use-market-price').checked;
            const input = document.getElementById('sim-price');
            input.disabled = isAuto;
            if(isAuto) input.value = MARKET_DATA.ars_price;
            runSimulation();
        }

        function setSimMethod(method) {
            simMethod = method;
            document.querySelectorAll('.sim-method-btn').forEach(btn => {
                if(btn.dataset.method === method) {
                    btn.className = "sim-method-btn px-3 py-2 rounded-md text-xs font-medium border transition bg-brand-primary/20 border-brand-primary text-white";
                } else {
                    btn.className = "sim-method-btn px-3 py-2 rounded-md text-xs font-medium border border-white/10 text-slate-400 hover:text-white transition";
                }
            });
            runSimulation();
        }

        function runSimulation() {
            const qtyToSell = parseInt(document.getElementById('sim-qty').value) || 0;
            const sellPriceArs = parseFloat(document.getElementById('sim-price').value) || 0;

            // 1. Revenue (Producido)
            const revenueArs = qtyToSell * sellPriceArs;
            const revenueUsd = revenueArs / MARKET_DATA.mep_sell; // Convert ARS -> USD at today's Sell Rate

            document.getElementById('sim-revenue-ars').textContent = fmtARS(revenueArs);
            document.getElementById('sim-revenue-usd').textContent = fmtUSD(revenueUsd);

            // 2. Cost (Logic of Consumption)
            let costArs = 0;
            let costUsd = 0;
            let remainingQty = qtyToSell;
            
            // Clone lots to not mutate original
            let sortedLots = [...MOCK_LOTES].map(l => ({...l})); 

            // Sort logic
            if (simMethod === 'FIFO') {
                sortedLots.sort((a, b) => new Date(a.date) - new Date(b.date));
            } else if (simMethod === 'LIFO') {
                sortedLots.sort((a, b) => new Date(b.date) - new Date(a.date));
            } else if (simMethod === 'CHEAPEST') {
                sortedLots.sort((a, b) => a.price_ars - b.price_ars);
            }
            // PPP is handled differently (mathematical avg), but let's simulate consuming "proportional" or standard avg for simplicity in prototype, 
            // OR strictly speaking, PPP implies average unit cost * qty. Let's do Average Unit Cost.
            
            const lotsConsumedList = document.getElementById('sim-lots-list');
            lotsConsumedList.innerHTML = '';

            if (simMethod === 'PPP') {
                // Average Calculation
                let totalH = 0, totalCArs = 0, totalCUsd = 0;
                MOCK_LOTES.forEach(l => {
                    totalH += l.qty;
                    totalCArs += l.qty * l.price_ars;
                    totalCUsd += (l.qty * l.price_ars) / l.mep_hist_sell;
                });
                const avgArs = totalCArs / totalH;
                const avgUsd = totalCUsd / totalH;
                
                costArs = avgArs * qtyToSell;
                costUsd = avgUsd * qtyToSell;
                lotsConsumedList.innerHTML = `<li class="text-[10px] text-slate-400">Promedio Ponderado aplicado a ${qtyToSell} un.</li>`;

            } else {
                // Specific Lot Consumption (FIFO/LIFO/CHEAPEST)
                for (let lot of sortedLots) {
                    if (remainingQty <= 0) break;
                    
                    const take = Math.min(remainingQty, lot.qty);
                    const lotCostArs = take * lot.price_ars;
                    const lotCostUsd = lotCostArs / lot.mep_hist_sell;

                    costArs += lotCostArs;
                    costUsd += lotCostUsd;
                    remainingQty -= take;

                    // Add to list
                    const li = document.createElement('li');
                    li.className = "flex justify-between text-[10px] text-slate-400 border-b border-white/5 py-1";
                    li.innerHTML = `<span>${lot.date}</span> <span>${take} un. @ $${lot.price_ars}</span>`;
                    lotsConsumedList.appendChild(li);
                }
            }

            document.getElementById('sim-cost-ars').textContent = fmtARS(costArs);
            document.getElementById('sim-cost-usd').textContent = fmtUSD(costUsd);

            // 3. Result
            const resArs = revenueArs - costArs;
            const pctArs = costArs > 0 ? (resArs / costArs) * 100 : 0;

            const resUsd = revenueUsd - costUsd;
            const pctUsd = costUsd > 0 ? (resUsd / costUsd) * 100 : 0;

            // Render Result
            const pnlArsEl = document.getElementById('sim-pnl-ars');
            pnlArsEl.textContent = fmtARS(resArs);
            pnlArsEl.className = `text-2xl font-mono font-bold tabular-nums ${resArs >= 0 ? 'text-semantic-up' : 'text-semantic-down'}`;
            
            const pctArsEl = document.getElementById('sim-pct-ars');
            pctArsEl.textContent = fmtPct(pctArs);
            pctArsEl.className = `text-xs mt-1 font-mono ${resArs >= 0 ? 'text-semantic-up' : 'text-semantic-down'}`;

            const pnlUsdEl = document.getElementById('sim-pnl-usd');
            pnlUsdEl.textContent = fmtUSD(resUsd);
            pnlUsdEl.className = `text-2xl font-mono font-bold tabular-nums ${resUsd >= 0 ? 'text-semantic-up' : 'text-semantic-down'}`;

            const pctUsdEl = document.getElementById('sim-pct-usd');
            pctUsdEl.textContent = fmtPct(pctUsd);
            pctUsdEl.className = `text-xs mt-1 font-mono ${resUsd >= 0 ? 'text-semantic-up' : 'text-semantic-down'}`;

            // Border
            const card = document.getElementById('sim-result-card');
            card.className = `glass p-5 rounded-xl border-l-4 relative overflow-hidden ${resUsd >= 0 ? 'border-l-semantic-up' : 'border-l-semantic-down'}`;
        }


        // UI Handlers
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            ['tab-lotes', 'tab-simulador', 'tab-calculo'].forEach(id => {
                const btn = document.getElementById('btn-' + id);
                btn.className = "border-transparent text-slate-400 hover:text-slate-200 py-3 px-1 border-b-2 font-medium text-sm transition-colors";
            });
            document.getElementById('btn-' + tabId).className = "border-brand-primary text-brand-primary py-3 px-1 border-b-2 font-medium text-sm transition-colors";
        }

        function openSell(qty) {
            switchTab('tab-simulador');
            document.getElementById('sim-qty').value = qty;
            runSimulation();
        }

        init();
    </script>
</body>
</html>